<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard Penjualan</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body { background-color: #f4f6f9; }
  .content { display: none; }
  .menu-btn button { min-width: 140px; }
  .card-custom { border-radius: 12px; }
</style>
</head>

<body>

<!-- ================= PROTEKSI LOGIN ================= -->
<script>
if (localStorage.getItem("login") !== "true") {
  alert("Silakan login terlebih dahulu!");
  window.location.href = "uas.html";
}
</script>

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-dark bg-primary shadow">
  <div class="container d-flex justify-content-between align-items-center">
    <span class="navbar-brand fw-bold">ðŸ“Š Dashboard</span>

    <div class="dropdown">
      <button class="btn btn-outline-light dropdown-toggle btn-sm" data-bs-toggle="dropdown">
        ðŸ‘¤ <span id="userLogin"></span>
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li>
          <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#profilModal">
            ðŸ‘¤ Profil
          </a>
        </li>
        <li><hr class="dropdown-divider"></li>
        <li>
          <a class="dropdown-item text-danger" href="#" onclick="logout()">ðŸšª Logout</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- ================= KONTEN ================= -->
<div class="container py-4">

  <div class="menu-btn mb-4 d-flex gap-2 flex-wrap">
    <button class="btn btn-primary" onclick="show('produk')">ðŸ“¦ Data Produk</button>
    <button class="btn btn-success" onclick="show('penjualan')">ðŸ’° Penjualan</button>
    <button class="btn btn-warning text-dark" onclick="show('riwayat')">ðŸ§¾ Riwayat</button>
  </div>

  <!-- DATA PRODUK -->
  <div id="produk" class="content">
    <div class="card shadow card-custom">
      <div class="card-body">
        <h5 class="fw-bold mb-3">ðŸ“¦ Data Produk</h5>

        <div class="row mb-3">
          <div class="col-md-4">
            <input id="nama" class="form-control" placeholder="Nama Produk">
          </div>
          <div class="col-md-4">
            <input id="harga" type="number" class="form-control" placeholder="Harga">
          </div>
          <div class="col-md-4 d-grid">
            <button class="btn btn-success" onclick="tambahProduk()">Tambah</button>
          </div>
        </div>

        <table class="table table-bordered table-striped">
          <thead class="table-primary">
            <tr>
              <th>No</th>
              <th>Nama</th>
              <th>Harga</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="produkTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- PENJUALAN -->
  <div id="penjualan" class="content">
    <div class="card shadow card-custom">
      <div class="card-body">
        <h5 class="fw-bold mb-3">ðŸ’° Input Penjualan</h5>
        <div class="row">
          <div class="col-md-4">
            <select id="jualProduk" class="form-control"></select>
          </div>
          <div class="col-md-4">
            <input id="jualQty" type="number" class="form-control" placeholder="Jumlah">
          </div>
          <div class="col-md-4 d-grid">
            <button class="btn btn-success" onclick="jual()">Simpan</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RIWAYAT -->
  <div id="riwayat" class="content">
    <div class="card shadow card-custom">
      <div class="card-body">
        <h5 class="fw-bold mb-3">ðŸ§¾ Riwayat Transaksi</h5>

        <table class="table table-bordered table-striped">
          <thead class="table-dark">
            <tr>
              <th>No</th>
              <th>Tanggal</th>
              <th>User</th>
              <th>Produk</th>
              <th>Qty</th>
              <th>Total</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="riwayatTable"></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<!-- ================= MODAL PROFIL ================= -->
<div class="modal fade" id="profilModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">ðŸ‘¤ Profil Pengguna</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- âœ… FOTO PROFIL DI SINI -->
      <div class="modal-body text-center">
        <img src="asset/profil.jpg"
             width="120" height="120"
             class="rounded-circle mb-3 border"
             style="object-fit:cover">

        <p><strong>Username:</strong> <span id="profilUsername"></span></p>
        <p><strong>NIM:</strong> 251011700765</p>
        <p><strong>Kelas:</strong> 903</p>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
      </div>

    </div>
  </div>
</div>

<!-- ================= SCRIPT ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const currentUser = localStorage.getItem("username") || "User";
document.getElementById("userLogin").innerText = currentUser;
document.getElementById("profilUsername").innerText = currentUser;

let produk = JSON.parse(localStorage.getItem("produk")) || [];
let riwayat = JSON.parse(localStorage.getItem("riwayat")) || [];

function logout(){
  if(confirm("Yakin ingin logout?")){
    localStorage.clear();
    window.location.href = "uas.html";
  }
}

function show(id){
  document.querySelectorAll(".content").forEach(el => el.style.display="none");
  document.getElementById(id).style.display="block";
}

function renderProduk(){
  produkTable.innerHTML = produk.map((p,i)=>`
    <tr>
      <td>${i+1}</td>
      <td>${p.nama}</td>
      <td>${p.harga}</td>
      <td>
        <button class="btn btn-danger btn-sm" onclick="hapusProduk(${i})">Hapus</button>
      </td>
    </tr>`).join("");
  localStorage.setItem("produk", JSON.stringify(produk));
  loadProdukSelect();
}

function tambahProduk(){
  if(!nama.value || !harga.value) return alert("Lengkapi data!");
  produk.push({nama:nama.value, harga:Number(harga.value)});
  nama.value=""; harga.value="";
  renderProduk();
}

function hapusProduk(i){
  produk.splice(i,1);
  renderProduk();
}

function loadProdukSelect(){
  jualProduk.innerHTML = produk.map((p,i)=>`
    <option value="${i}">${p.nama} - ${p.harga}</option>`).join("");
}

function jual(){
  const p = produk[jualProduk.value];
  const qty = Number(jualQty.value);
  if(!qty) return alert("Masukkan jumlah!");
  riwayat.push({
    tanggal:new Date().toLocaleString(),
    user:currentUser,
    produk:p.nama,
    qty,
    total:p.harga*qty
  });
  localStorage.setItem("riwayat", JSON.stringify(riwayat));
  jualQty.value="";
  renderRiwayat();
}

function renderRiwayat(){
  riwayatTable.innerHTML = riwayat.map((r,i)=>`
    <tr>
      <td>${i+1}</td>
      <td>${r.tanggal}</td>
      <td>${r.user}</td>
      <td>${r.produk}</td>
      <td>${r.qty}</td>
      <td>${r.total}</td>
      <td>
        <button class="btn btn-danger btn-sm" onclick="hapusRiwayat(${i})">Hapus</button>
      </td>
    </tr>`).join("");
}

function hapusRiwayat(i){
  riwayat.splice(i,1);
  localStorage.setItem("riwayat", JSON.stringify(riwayat));
  renderRiwayat();
}

renderProduk();
renderRiwayat();
show("produk");
</script>

</body>
</html>
